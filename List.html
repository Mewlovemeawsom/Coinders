<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายการของฉัน</title>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet"> 

  <style>
    body {
      font-family: 'Kanit', sans-serif; /* 2. ตั้งค่าให้ใช้ฟอนต์ Kanit */
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      padding-bottom: 70px;
    }
    .header {
      text-align: center;
      padding: 20px;
      color: #124170;
      font-weight: 400;
    }

    /* === Toggle Container + Indicator === */
    .toggle-container {
      position: relative;
      display: inline-flex;
      width: 200px;
      background: #67C090;
      border-radius: 30px;
      overflow: hidden;
      padding: 2px;
      margin-top: 10px;
      left: 120px;
    }

    .toggle-btn {
      flex: 1;
      background: transparent;
      border: none;
      padding: 8px 0;
      font-size: 14px;
      cursor: pointer;
      color: #DDF4E7;
      font-weight: 600;
      z-index: 1;
      transition: color 0.3s ease;
    }

    .toggle-btn.active {
      color: #DDF4E7;
    }

    .toggle-indicator {
      position: absolute;
      top: 2px;
      left: 2px;
      width: calc(50% - 2px);
      height: calc(100% - 4px);
      background: #26667F;
      border-radius: 30px;
      transition: all 0.3s ease;
      z-index: 0;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .toggle-container {
        width: 150px;
      }
      .toggle-btn {
        font-size: 12px;
      }
    }

    /* Section แสดงผล */
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    /* หน้า “รวม” */
    .card {
      background: #fff;
      border-radius: 14px;
      margin: 10px;
      padding: 10px 20px;
      display: flex;
      align-items: center; 
      justify-content: space-between;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
    }

    /* ตำแหน่งของจุดในหน้ารวม (ขวาบน) */
    .summary-dot-wrapper {
        position: absolute; 
        top: 10px; 
        right: 20px;
        z-index: 10;
    }
    
    /* สไตล์สำหรับไอคอนจุดสามจุดทั้งหมด */
    .dot-icon {
        color: #666666; /* สีจุด */
        width: 20px;
        height: 20px;
    }

    /* NEW: ทำให้จุดกดได้และดูดี */
    .dot-button {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
        display: flex; 
        align-items: center;
        justify-content: center;
    }

    /* สไตล์ไอคอนหลัก */
    .card-icon {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      margin-right: 15px;
      background-color: transparent; 
    }

    /* สีไอคอนตามประเภท */
    .icon-food {
      color: #CC4C4C;
    }
    .icon-income {
      color: #67C090;
    }
    .icon-expense {
      color: #CC4C4C;
    }

    .card-info {
      flex: 1;
    }
    /* ชื่อรายการ */
    .card-info > div:first-child {
      font-weight: 500; 
      font-size: 17px; 
    }

    /* สไตล์สำหรับไอคอนสามเหลี่ยมและจำนวนเงิน */
    .amount-text {
      font-size: 14px; 
      display: flex;
      align-items: center; 
    }

    .triangle-icon {
      width: 16px; 
      height: 16px;
      margin-right: 5px; 
      transition: transform 0.3s;
    }
    
    .triangle-down {
      transform: rotate(180deg);
    }

    /* วันที่ไปอยู่ขวาล่าง */
    .date-text {
      font-size: 11px; 
      color: #777;
      white-space: nowrap;
    }
    
    /* จัดให้วันที่อยู่มุมขวาของรายการ */
    .transaction-details {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        justify-content: flex-end; 
        align-self: flex-end; 
        height: 100%; 
    }

    
    .summary-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
    }
    
    .summary-left {
        display: flex;
        align-items: center;
    }


    /* หน้า “รายวัน” */
    .date-group {
      background: #fff;
      border-radius: 10px;
      margin: 10px;
      padding: 15px;
    }
    
    .date-header {
      display: flex; 
      justify-content: space-between; 
      align-items: flex-start; 
      margin-bottom: 10px; 
    }

    .date-text-only { 
      font-size: 16px;
    }

    .item-count-text {
      font-size: 11px; 
      color: #777; 
      font-weight: normal; 
      margin-top: 2px;
    }
    
    .item-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .item-card {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      width: 100px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .item-card .card-icon {
        width: 40px;
        height: 40px;
        margin: auto;
        margin-bottom: 5px;
        background-color: transparent; 
    }
    
    /* Wrapper สำหรับจัดกลุ่มจำนวนเงินและจุด (ในหน้ารายวัน) */
    .amount-and-dot {
        display: flex;
        flex-direction: column;
        align-items: center; 
        margin-top: 5px; 
    }

    .item-card .amount-text {
        font-size: 12px; 
        margin-top: 0; 
        justify-content: center;
    }
    
    .item-card .triangle-icon {
        width: 14px; 
        height: 14px;
    }
    
    /* จัดระยะห่างของจุดในหน้ารายวัน */
    .daily-dot-icon {
        margin-top: 2px;
    }


    /* ปุ่มเพิ่มรายการ */
    .add-button {
      display: block;
      width: 25%;
      height: 30px;
      margin: 20px auto;
      background: #26667F;
      color: #fff;
      text-align: center;
      padding: 15px;
      border-radius: 14px;
      text-decoration: none;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #67C090; 
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1); 
      z-index: 1000; 
    }

    .nav-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px; 
      cursor: pointer;
      color: #FFFFFF; /* สีไอคอนปกติเป็นสีขาว */
      transition: color 0.3s;
      text-decoration: none; 
    }

    .nav-icon svg, .nav-icon i { 
      display: block;
      width: 24px;
      height: 24px;
    }

    .active-icon {
      color: #124170; /* สีไอคอนเมื่อ Active (เปลี่ยนจาก #DDF4E7 เป็น #124170) */
    }
    
    /* === Modal and Action Menu Styles (UPDATED) === */
    
    /* Action Menu Container */
    #actionMenu { 
        position: absolute;
        z-index: 1000;
        background: white;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        width: 120px; /* เพิ่มความกว้าง */
        display: none; /* Default hidden, JS will change this to flex */
        padding: 5px 0;
        flex-direction: column;
    }

    .menu-option {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        font-family: 'Kanit', sans-serif;
        transition: background-color 0.1s;
    }
    .menu-option svg {
        margin-right: 8px;
        width: 16px;
        height: 16px;
    }

    .menu-option:hover {
        background-color: #f0f0f0;
    }

    .edit-option {
        color: #124170; /* สีน้ำเงินเข้ม */
    }

    .delete-option {
        color: #CC4C4C; /* สีแดง */
        font-weight: 500;
    }

    /* Confirmation Modal (Dark overlay) */
    #confirmation-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: none; /* Default hidden */
        justify-content: center;
        align-items: center;
    }
    
    /* Modal box content */
    #confirmation-modal > div {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        width: 80%;
        max-width: 300px;
    }
    
    #confirmation-modal p {
        margin: 0;
        font-size: 16px;
        font-weight: 500;
    }
    
    /* Modal buttons */
    #cancel-btn, #confirm-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    #cancel-btn {
        background: #ccc;
        color: black;
        margin-right: 10px;
    }
    #confirm-btn {
        background: #CC4C4C;
        color: white;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>รายการของฉัน</h2>
    <div class="toggle-container">
      <button class="toggle-btn active" data-target="summary" id="btnTotal">รวม</button>
      <button class="toggle-btn" data-target="daily" id="btnDaily">รายวัน</button>
      <div class="toggle-indicator" id="toggleIndicator"></div>
    </div>
  </div>
  
  <svg style="display:none;" id="triangle-svg" viewBox="0 0 24 24"><path fill="currentColor" d="M16.21 16H7.79a1.76 1.76 0 0 1-1.59-1a2.1 2.1 0 0 1 .26-2.21l4.21-5.1a1.76 1.76 0 0 1 2.66 0l4.21 5.1A2.1 2.1 0 0 1 17.8 15a1.76 1.76 0 0 1-1.59 1"/></svg>

  <div id="summary" class="section active">
    
  </div>

  <div id="daily" class="section">
    
    
  </div>

  <a href="record.html" class="add-button">+ เพิ่มรายการ</a>

  <div class="footer">

    <div class="bottom-nav">
  <a href="hello.html" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m3 9l9-7l9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/><path d="M9 22V12h6v10"/></g></svg>
  </a>

  <a href="List.html" class="nav-icon active-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm6 0H5v4h4zm4 0a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2zm6 0h-4v4h4zM3 15a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm6 0H5v4h4zm4 0a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2zm6 0h-4v4h4z"/></svg>
  </a>

  <a href="graph.html" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M2.7 17.625q-.3-.3-.288-.712t.288-.688l5.275-5.35Q8.55 10.3 9.4 10.3t1.425.575l2.575 2.6l5.2-5.15H17q-.425 0-.712-.288T16 7.326t.288-.712t.712-.288h4q.425 0 .713.288t.287.712v4q0 .425-.288.713t-.712.287t-.712-.287t-.288-.713v-1.6L14.825 14.9q-.575.575-1.425.575t-1.425-.575L9.4 12.325l-5.3 5.3q-.275.275-.7.275t-.7-.275"/></svg>
  </a>

  <a href="Profile.html" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z"/></svg>
  </a>
</div>
  </div>
  
  <div id="actionMenu" class="action-menu">
    <button id="editOptionBtn" class="menu-option edit-option">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"/></svg>
        แก้ไข
    </button>
    <button id="deleteOptionBtn" class="menu-option delete-option">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"/></svg>
        ลบ
    </button>
  </div>

  <div id="confirmation-modal">
    <div>
      <p>คุณต้องการลบรายการนี้หรือไม่</p>
      <div style="margin-top: 20px;">
        <button id="cancel-btn">ยกเลิก</button>
        <button id="confirm-btn">ยืนยัน</button>
      </div>
    </div>
  </div>

  <script>
    // === Toggle Button Logic ===
    const toggleIndicator = document.getElementById('toggleIndicator'); 
    const btnTotal = document.getElementById('btnTotal');
    const btnDaily = document.getElementById('btnDaily');
    const sections = document.querySelectorAll('.section');
    const buttons = [btnTotal, btnDaily];

    function updateIndicator(targetButton) {
        if (targetButton.id === 'btnTotal') {
            toggleIndicator.style.transform = 'translateX(0%)';
        } else {
            toggleIndicator.style.transform = 'translateX(100%)';
        }
    }

    function setActiveTab(clickedButton) {
        buttons.forEach(btn => {
            btn.classList.remove('active');
            btn.style.color = '#DDF4E7';
        });
        clickedButton.classList.add('active');
        clickedButton.style.color = '#fff';
        updateIndicator(clickedButton);

        sections.forEach(sec => sec.classList.remove('active'));
        const targetSectionId = clickedButton.getAttribute('data-target');
        document.getElementById(targetSectionId).classList.add('active');

        // *************** NEW: เรียกฟังก์ชันแสดงผลตาม Tab ***************
        if (targetSectionId === 'summary') {
            renderTransactions(); // รวม
        } else if (targetSectionId === 'daily') {
            renderDailyTransactions(); // รายวัน
        }
        // ****************************************************************
    }
    
    // เชื่อม Event listener สำหรับ Toggle
    buttons.forEach(btn => {
        btn.addEventListener('click', () => setActiveTab(btn));
    });

    // ตั้งค่าเริ่มต้น
    updateIndicator(btnTotal); 
    if(btnTotal) btnTotal.style.color = '#fff'; 
    // สิ้นสุดส่วน Toggle

    // === Modal and Menu Logic (UNCHANGED from previous step) ===
    const actionMenu = document.getElementById('actionMenu'); 
    const confirmationModal = document.getElementById('confirmation-modal');
    const deleteOptionBtn = document.getElementById('deleteOptionBtn'); 
    const editOptionBtn = document.getElementById('editOptionBtn');   
    const cancelBtn = document.getElementById('cancel-btn');
    const confirmBtn = document.getElementById('confirm-btn');
    let selectedItemId = null; 

    window.showActionMenu = function(event) { 
        hideActionMenu();
        event.stopPropagation();
        
        const button = event.currentTarget; 
        const cardElement = button.closest('.card, .item-card'); // **แก้ไข: รองรับ .item-card ด้วย**
        
        if (cardElement) {
            selectedItemId = cardElement.getAttribute('data-id'); 
        } else {
            selectedItemId = 'MOCK_ID_NOT_FOUND';
        }
        
        const rect = button.getBoundingClientRect();
        
        actionMenu.style.top = `${rect.bottom + window.scrollY}px`; 
        const menuWidth = 120; 
        actionMenu.style.left = `${rect.right + window.scrollX - menuWidth}px`; 
        actionMenu.style.display = 'flex'; 

        document.addEventListener('click', hideActionMenuOnce, { once: true });
    }

    function hideActionMenu() {
        actionMenu.style.display = 'none';
        document.removeEventListener('click', hideActionMenuOnce);
    }
    
    function hideActionMenuOnce(event) {
        if (event.target.closest('#actionMenu')) {
            return;
        }
        hideActionMenu();
    }

    function showConfirmationModal() {
        hideActionMenu();
        confirmationModal.style.display = 'flex';
    }

    function hideConfirmationModal() {
        confirmationModal.style.display = 'none';
    }

    function showEditModal() {
        hideActionMenu();
        alert(`กำลังจะเปิด Modal แก้ไขรายการ\nรายการ ID: ${selectedItemId}`);
    }

    editOptionBtn.addEventListener('click', showEditModal); 
    deleteOptionBtn.addEventListener('click', showConfirmationModal);
    cancelBtn.addEventListener('click', hideConfirmationModal);
    confirmBtn.addEventListener('click', () => {
        deleteTransaction(selectedItemId);
        hideConfirmationModal();
    });

    // === Bottom Nav Logic (UNCHANGED) ===
    const footerIcons = document.querySelectorAll('.bottom-nav a'); 
    const currentPath = window.location.pathname.split('/').pop() || 'hello.html'; 

    footerIcons.forEach(link => {
        const targetFile = link.getAttribute('href').split('/').pop();
        if (targetFile === currentPath) {
            link.classList.add('active-icon'); 
        } else {
            link.classList.remove('active-icon');
        }
    });

    // === Logic สำหรับแสดงรายการธุรกรรม (ห่อหุ้มด้วย DOMContentLoaded) ===
    document.addEventListener('DOMContentLoaded', () => {
        const summarySection = document.getElementById('summary');
        const dailySection = document.getElementById('daily'); // NEW
        const TRANSACTIONS_KEY = 'transactions';

        // --- NEW: ฟังก์ชันจัดกลุ่มและจัดรูปแบบวันที่ ---
        function groupTransactionsByDate(transactions) {
            const grouped = transactions.reduce((acc, transaction) => {
                const parts = transaction.date.split(' '); // e.g., "2 ก.ย. 2025"
                const dateKey = parts[0] + ' ' + parts[1] + ' ' + parts[2]; // ใช้รูปแบบ "วัน เดือน ปี" เป็นคีย์
                
                if (!acc[dateKey]) {
                    acc[dateKey] = [];
                }
                acc[dateKey].push(transaction);
                return acc;
            }, {});

            // เรียงลำดับวันที่จากใหม่ไปเก่า (2025 > 2024, ก.ย. > ส.ค.)
            const sortedDates = Object.keys(grouped).sort((a, b) => {
                // แปลงเป็นวัตถุ Date เพื่อเปรียบเทียบ
                const dateA = new Date(a.replace('ม.ค.', 'Jan').replace('ก.พ.', 'Feb').replace('มี.ค.', 'Mar').replace('เม.ย.', 'Apr').replace('พ.ค.', 'May').replace('มิ.ย.', 'Jun').replace('ก.ค.', 'Jul').replace('ส.ค.', 'Aug').replace('ก.ย.', 'Sep').replace('ต.ค.', 'Oct').replace('พ.ย.', 'Nov').replace('ธ.ค.', 'Dec'));
                const dateB = new Date(b.replace('ม.ค.', 'Jan').replace('ก.พ.', 'Feb').replace('มี.ค.', 'Mar').replace('เม.ย.', 'Apr').replace('พ.ค.', 'May').replace('มิ.ย.', 'Jun').replace('ก.ค.', 'Jul').replace('ส.ค.', 'Aug').replace('ก.ย.', 'Sep').replace('ต.ค.', 'Oct').replace('พ.ย.', 'Nov').replace('ธ.ค.', 'Dec'));
                return dateB - dateA; // ใหม่ไปเก่า
            });

            const sortedGrouped = {};
            sortedDates.forEach(date => {
                // เรียงรายการภายในแต่ละวันจากใหม่ไปเก่า (ตาม ID)
                grouped[date].sort((a, b) => b.id - a.id);
                sortedGrouped[date] = grouped[date];
            });

            return sortedGrouped;
        }


        // --- NEW: ฟังก์ชันสร้าง Card รายวัน ---
        function createDailyItemCard(transaction) {
            const isExpense = transaction.type === 'expense';
            const iconColor = isExpense ? '#CC4C4C' : '#67C090';
            const amountSign = isExpense ? '▼' : '▲';
            
            return `
                <div class="item-card" data-id="${transaction.id}">
                    <div class="card-icon" style="color: ${iconColor};">
                        ${transaction.iconHtml}
                    </div>
                    <div>${transaction.category}</div>
                    <div class="amount-text" style="color: ${iconColor};">
                        ${amountSign} ${transaction.amount.toLocaleString('th-TH')}
                    </div>
                </div>
            `;
        }


        // --- NEW: ฟังก์ชันแสดงรายการรายวันทั้งหมด ---
        window.renderDailyTransactions = function() {
            const existingTransactionsJSON = localStorage.getItem(TRANSACTIONS_KEY);
            const transactions = existingTransactionsJSON ? JSON.parse(existingTransactionsJSON) : [];
            
            if (!dailySection) return;

            if (transactions.length === 0) {
                dailySection.innerHTML = '<p style="text-align: center; margin-top: 50px; color: #777;">ยังไม่มีรายการในขณะนี้</p>';
                return;
            }

            const groupedTransactions = groupTransactionsByDate(transactions);
            let dailyHtml = '';

            for (const date in groupedTransactions) {
                const dailyItems = groupedTransactions[date];
                const totalExpense = dailyItems.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const totalIncome = dailyItems.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const netBalance = totalIncome - totalExpense;

                dailyHtml += `
                    <div class="date-group">
                        <div class="date-header">
                            <div>
                                <div class="date-text-only">${date}</div>
                                <div class="item-count-text">${dailyItems.length} รายการ</div>
                            </div>
                            <div style="text-align: right; font-size: 12px; margin-top: 2px;">
                                <div style="color: #CC4C4C;">${totalExpense.toLocaleString('th-TH')} THB</div>
                                <div style="color: #67C090; margin-top: 3px;">${totalIncome.toLocaleString('th-TH')} THB</div>
                                <div style="color: ${netBalance >= 0 ? '#124170' : '#CC4C4C'}; margin-top: 3px;">คงเหลือ: ${netBalance.toLocaleString('th-TH')} THB</div>
                            </div>
                        </div>
                        <div class="item-list">
                            ${dailyItems.map(createDailyItemCard).join('')}
                        </div>
                    </div>
                `;
            }
            dailySection.innerHTML = dailyHtml;
        };
        // -----------------------------------------------------------------


        // ฟังก์ชันลบรายการจริง (UNCHANGED)
        function deleteTransaction(idToDelete) {
            const existingTransactionsJSON = localStorage.getItem(TRANSACTIONS_KEY);
            let transactions = existingTransactionsJSON ? JSON.parse(existingTransactionsJSON) : [];
            
            const filteredTransactions = transactions.filter(t => t.id != idToDelete);
            
            localStorage.setItem(TRANSACTIONS_KEY, JSON.stringify(filteredTransactions));
            renderTransactions(); // รีเฟรชรายการในแท็บรวม
            renderDailyTransactions(); // รีเฟรชรายการในแท็บรายวัน
            alert('ลบรายการ ID: ' + idToDelete + ' เรียบร้อยแล้ว');
        }
        window.deleteTransaction = deleteTransaction; 


        // --- ฟังก์ชันแสดงรายการรวมทั้งหมด (UNCHANGED) ---
        function createTransactionCard(transaction) {
            const isExpense = transaction.type === 'expense';
            const amountClass = isExpense ? 'icon-expense' : 'icon-income';
            const iconColor = isExpense ? '#CC4C4C' : '#67C090';
            
            return `
                <div class="card" data-id="${transaction.id}">
                    <div class="summary-left">
                        <div class="card-icon ${amountClass}" style="color: ${iconColor};">
                            ${transaction.iconHtml}
                        </div>
                        <div class="card-info">
                            <div>${transaction.category}</div>
                            <div class="amount-text" style="color: ${iconColor};">
                                <span class="triangle-icon">
                                    ${transaction.type === 'expense' ? 
                                        '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M16.21 16H7.79a1.76 1.76 0 0 1-1.59-1a2.1 2.1 0 0 1 .26-2.21l4.21-5.1a1.76 1.76 0 0 1 2.66 0l4.21 5.1A2.1 2.1 0 0 1 17.8 15a1.76 1.76 0 0 1-1.59 1"/></svg>'
                                        :
                                        '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M16.21 16H7.79a1.76 1.76 0 0 1-1.59-1a2.1 2.1 0 0 1 .26-2.21l4.21-5.1a1.76 1.76 0 0 1 2.66 0l4.21 5.1A2.1 2.1 0 0 1 17.8 15a1.76 1.76 0 0 1-1.59 1" transform="rotate(180 12 12)"/></svg>'
                                    }
                                </span>
                                ${transaction.amount.toLocaleString('th-TH')} THB
                            </div>
                        </div>
                    </div>
                    <div class="transaction-details">
                        <div class="date-text">${transaction.date}</div>
                        <div class="summary-dot-wrapper">
                            <button class="dot-button" onclick="showActionMenu(event)">
                                <svg class="dot-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 16a2 2 0 1 1 0 4a2 2 0 0 1 0-4m0-6a2 2 0 1 1 0 4a2 2 0 0 1 0-4m0-6a2 2 0 1 1 0 4a2 2 0 0 1 0-4"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTransactions() {
            const existingTransactionsJSON = localStorage.getItem(TRANSACTIONS_KEY);
            const transactions = existingTransactionsJSON ? JSON.parse(existingTransactionsJSON) : [];
            
            transactions.sort((a, b) => b.id - a.id); 

            if (summarySection) {
                summarySection.innerHTML = transactions.map(createTransactionCard).join('');
            }
        }

        // เรียกฟังก์ชันแสดงผลเริ่มต้น (แท็บ "รวม")
        renderTransactions(); 
    });
</script>
</body>
</html>